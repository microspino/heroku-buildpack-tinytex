#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e

BUILD_DIR=$1
CACHE_DIR=$2
BINDIR=$(cd $(dirname $0); pwd)
PLATFORM=$(uname -m)-$(uname -s | tr A-Z a-z)
TINYTEX_HOME=$BUILD_DIR/TinyTeX
PATH=$TINYTEX_HOME/bin/${PLATFORM}:$PATH

source $BINDIR/utils

mkdir -p $TINYTEX_HOME

cd ./bin
tar -vzxf tiny-tex-installer-unix.tar.gz
./install.sh

tlmgr option sys_bin $BINDIR
tlmgr postaction install script xetex
tlmgr option repository ctan
tlmgr path add

if [ ! `which pdflatex` ]; then
    build-warn "TinyTex installation failed"
    exit 1
fi

# echo "export PATH=\$TINYTEX_HOME/bin/${PLATFORM}:\$PATH" >> $PROFILE_D
